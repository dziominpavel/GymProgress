# План: алгоритм оценки «какая тренировка лучше»

## Контекст
Приложение хранит: мышечную группу, упражнение, вес, подходы и повторы.
Цель пользователя в примере: **набор мышечной массы**.
Базовый рабочий диапазон: **8–12 повторов** для основных упражнений.

---

## 1) Почему «просто больше вес» — недостаточно
Сравнение только по весу ломается в сценариях:
- +5 кг, но резкое падение повторов (например, -3/-4 в сумме) — не всегда прогресс для гипертрофии.
- Подтягивания: вариант с доп. весом 10 кг × 2 повтора может быть хуже для цели гипертрофии, чем BW × 10.

Нужен комбинированный скоринг, учитывающий:
1. Объём работы,
2. Интенсивность,
3. Попадание в целевой диапазон повторов,
4. Стабильность выполнения подходов,
5. Прогресс относительно собственной прошлой сессии в том же упражнении.

---

## 2) Минимальные данные (MVP)
Для старта достаточно текущих данных + пара вычислений:
- `exerciseName`
- `weight`
- `reps[]` по подходам
- `date`
- производные:
  - `totalReps = sum(reps)`
  - `sets = reps.count()`
  - `volume = weight * totalReps`
  - `avgReps = totalReps / sets`

Для подтягиваний/отжиманий желательно добавить:
- `bodyWeight` на дату тренировки (или усреднённый, если нет ежедневного).

Тогда для bodyweight-движений:
- `effectiveLoad = bodyWeight + addedWeight`.

---

## 3) Алгоритм скоринга (для гипертрофии)

### 3.1. Шаг A: Базовый компонент объёма
`volumeScore = normalize(volume, historyWindow)`

Где `normalize(x)` — нормализация по истории конкретного упражнения пользователя за последние N сессий (например, 12).

### 3.2. Шаг B: Компонент интенсивности
`intensity = weight` (или `effectiveLoad` для BW-упражнений)
`intensityScore = normalize(intensity, historyWindow)`

### 3.3. Шаг C: Качество повторений под цель 8–12
Для каждого подхода:
- если reps в [8..12] → 1.0
- 6–7 или 13–15 → 0.7
- <=5 или >=16 → 0.4

`repQuality = average(setQuality)`

### 3.4. Шаг D: Штраф за «просадку» по подходам
Если повторения сильно падают от 1-го к последнему сету (например, >35%), применяем штраф:
`fatiguePenalty in [0..0.15]`

### 3.5. Итоговый балл сессии
`sessionScore = 0.45*volumeScore + 0.25*intensityScore + 0.30*repQuality - fatiguePenalty`

Итог ограничиваем в [0..1].

---

## 4) Правило «сессия лучше/хуже предыдущей»
Сравниваем текущую и предыдущую сессию **в рамках одного упражнения**:
- `delta = currentScore - previousScore`
- если `delta >= +0.05` → **лучше**
- если `delta <= -0.05` → **хуже**
- иначе → **на уровне**

Дополнительно показывать причины:
- «Лучше за счёт объёма (+12%) при сохранении повторов в диапазоне 8–12»
- «Хуже: вес выше, но выход из диапазона (много подходов <=5 повторов)»

---

## 5) Частный кейс: подтягивания (пример из задачи)
- BW × 10, 10, 9
- +10 кг × 2, 2, 2

Для цели гипертрофии второй вариант обычно проиграет из-за низкого `repQuality`.
Но +10 кг × 8, 7, 6 может дать высокий балл за интенсивность и приемлемое качество, и уже считаться прогрессом.

---

## 6) Какие доп. поля полезно добавить
Обязательные для расширенной точности:
1. `goal` (hypertrophy / strength / endurance)
2. `exerciseType` (compound / isolation)
3. `bodyWeight` (для BW движений)
4. `rir` или `rpe` по подходам (насколько близко к отказу)

Желательные:
5. Пол, возраст, стаж тренировок (для персонализации порогов)
6. Флаг травм/ограничений
7. Время отдыха между подходами

---

## 7) Как встроить в приложение по этапам

### Этап 1 (быстрый, без миграций)
- Считать `sessionScore` на лету из текущих полей.
- На экране «Прогресс» показывать бейдж: «лучше / на уровне / хуже» + краткая причина.

### Этап 2 (минимальная миграция)
- Добавить `goal`, `exerciseType`, `bodyWeight`.
- Для BW упражнений использовать `effectiveLoad`.

### Этап 3 (продвинуто)
- Добавить `RIR/RPE`, авто-рекомендации веса на следующую тренировку.
- Персонализировать веса компонентов формулы под цель пользователя.

---

## 8) Рекомендуемая формула для вашего случая (набор массы)
Для основных упражнений (жим, тяги, присед):
- целевой диапазон: 8–12
- веса коэффициентов: объём 45%, интенсивность 25%, качество 30%

Для изолирующих можно сместить в сторону качества повторов:
- объём 40%, интенсивность 15%, качество 45%

---

## 9) Что показать пользователю в UI
- Число: `Score 0..100`
- Статус: `▲ Лучше / → Без изменений / ▼ Хуже`
- Причина в одну строку:
  - «+5 кг, но средние повторы вышли из диапазона 8–12»
  - «Объём +9%, качество подходов стабильно»

Так пользователь понимает **почему** оценка именно такая, а не просто «магический балл».
